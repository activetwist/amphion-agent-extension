# Evaluation: Command Deck Toaster & Agent Rules Collision (v1.13.0)

**Date:** 2026-02-21
**Phase:** 1 (Evaluate)
**Topic:** Implementing a first-time launch "toaster" notification in the Command Deck and preventing collisions with existing agent rule files.

## 1. Research & Current State

### Issue 1: Command Deck Toaster
* **Current State:** The Command Deck GUI (`command-deck-source/public/`) currently launches silently. There is no first-time user guidance pointing them to the MCD Guide.
* **Goal:** Display a sleek, one-time toast notification on the first run: "Explore your Command Deck, and visit the MCD Guide to learn more about how to ship faster with Micro-Contract Development."

### Issue 2: Agent Rules Collisions
* **Current State:** The `scaffolder.ts` script uses a definitive `writeFile` wrapper. When initializing a project, it creates `.cursorrules` using `renderCursorRules(config)`. If a user scaffolds a project onto a directory that *already has* a `.cursorrules` (or `.clinerules`) file configured for their specific agent, the scaffolder completely overwrites it, destroying their personal agent instructions.
* **Goal:** Safely inject MCD Governance rules without destroying existing host configurations.

## 2. Gap Analysis & Proposed Direction

### Fix 1: Command Deck Toaster
* Add a simple HTML notification banner (the "toaster") to `index.html` within the `command-deck-source/public` directory.
* Add minimal CSS to style it beautifully (fixed positioning, shadow, elegant entrance animation).
* In `app.js`, upon `bootstrap()`, check `localStorage.getItem("mcdWelcomeShown")`.
* If false/null, display the toaster. Include a close button that sets the `localStorage` flag and removes the toaster from the DOM.

### Fix 2: Appending Agent Rules
* Modify `src/scaffolder.ts`. Instead of blindly writing the adapter files, we should create a new helper function: `appendOrWriteFile`.
* `appendOrWriteFile` will check if the target file (like `.cursorrules`) already exists.
  * If it exists, it will gracefully read the current contents, append a newline and a clear section header (`\n\n# --- MCD Governance Core Rules ---\n\n`), and append the MCD rules.
  * If it does not exist, it will create the file normally.
* Apply this safe-append logic to `.cursorrules`. Additionally, because many users use Roo Code, AI Toolkit, or Cline, we should also generate/append to a `.clinerules` file using the exact same playbook rules to maximize compatibility without destroying anything.

## 3. Scoping & Boundaries
**In-Scope:**
- Implementing the toaster feature in `command-deck-source/public/` (and copying to extension assets).
- Adding safe-append file logic in `scaffolder.ts`.
- Supporting `.clinerules` alongside `.cursorrules`.
- Packaging as minor version bump v1.13.0.

**Out-of-Scope:**
- Modifying the actual content of the governance rules.
- Writing complex parsers for existing rule files (simple bottom-appending is perfectly safe and functional for LLMs).
