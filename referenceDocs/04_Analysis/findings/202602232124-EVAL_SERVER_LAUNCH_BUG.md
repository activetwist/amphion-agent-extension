# EVALUATE: Server Launch Port Bug

**Phase: 1 (Research & Scoping)**
**Date:** 2026-02-23
**Focus:** Server start mechanism from the Command Deck Dashboard WebView

## 1. Research & Analysis
- **The Issue:** The user reports that while the initial onboarding properly respects the selected port (e.g., `4123`) and language backend (`node` vs `python`), clicking the "Server Start" button in the Command Deck Webview at a later point disregards these settings and defaults to `node` on port `8765` (and eventually failing over to Python if Node fails).
- **Root Cause:** The `config` object generated by the `wizard.ts` (containing `port`, `serverLang`, `projectName`, etc.) is used during the initial scaffold but is **never persisted to disk**. Consequently, `commandDeckDashboard.ts` has no way to retrieve the user's choices. It currently hardcodes `Command Deck :8765` and `node ops/launch-command-deck/server.js --port 8765` when the `startServer` IPC message is received.

## 2. Gap Analysis
- The project's scaffolding configuration (`ProjectConfig`) needs to be serialized and saved to the workspace so the extension's various commands and webviews can access the project context in subsequent sessions.

## 3. Scoping Boundaries
**In-Scope:**
- Modify `scaffolder.ts` to write `ops/amphion.json` containing the `{ port, serverLang, projectName, codename }` properties from the `config` object.
- Modify `commandDeckDashboard.ts` (`startServer` handler) to attempt to read and parse `ops/amphion.json` to retrieve the correct `port` and `serverLang`.
- Update the terminal launch command to respect the parsed language (`node` vs `python3`) and port.
- Generate and package a `1.25.9` VSIX patch.

**Out-of-Scope:**
- Migrating the wizard config to VS Code workspace settings (`settings.json`). A dedicated file (`ops/amphion.json`) is more explicit for MCD projects.

## 4. Primitive Review
We are introducing a new core artifact: `ops/amphion.json`. This acts as the project's metadata manifest for the Amphion extension suite, allowing the extension to "remember" the project's state.
