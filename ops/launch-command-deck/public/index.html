<!doctype html>
<html lang="en" data-theme="dark" data-current-view="board">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Launch Command Board</title>
  <link rel="stylesheet" href="/styles.css" />
  <script>
    (function () {
      var view = localStorage.getItem("mcd_current_view") || "board";
      if (view === "wiki") {
        view = "board";
        localStorage.setItem("mcd_current_view", "board");
      }
      document.documentElement.setAttribute('data-current-view', view);
      var theme = localStorage.getItem("mcd_theme") || "dark";
      if (theme === "light") {
        document.documentElement.setAttribute('data-theme', 'light');
      }
      var collapsed = localStorage.getItem("mcd_sidebar_collapsed") === "true";
      if (collapsed) {
        document.documentElement.setAttribute('data-sidebar-collapsed', 'true');
      }
    })();
  </script>
</head>

<body>
  <div class="app-shell">
    <header class="global-header">
      <div class="global-header-main">
        <h1>Command Deck</h1>
        <nav class="nav-tabs" id="navTabs">
          <button class="nav-tab active" data-view="board">Board</button>
          <button class="nav-tab" data-view="dashboard">Dashboard</button>
          <button class="nav-tab" data-view="charts">Charts</button>
          <button class="nav-tab" data-view="guide">MCD Guide</button>
        </nav>
      </div>
      <div class="global-header-actions">
        <button id="btnThemeToggle" class="btn btn-theme-toggle">Light Mode</button>
        <button id="btnNewBoard" class="btn primary">New Board</button>
      </div>
    </header>

    <aside class="sidebar">
      <header class="sidebar-header">
        <button id="btnToggleSidebar" class="btn-sidebar-toggle" title="Toggle Sidebar">«</button>
      </header>
      <section class="panel">
        <h2>Boards</h2>
        <div id="boardList" class="board-list"></div>
      </section>

      <section class="panel">
        <h2>Milestone Progress</h2>
        <div id="milestoneProgress" class="milestone-list"></div>
      </section>

      <section class="panel">
        <h2>Utilities</h2>
        <div class="utility-actions">
          <button id="btnCloneBoard" class="btn">Clone Active</button>
          <button id="btnExportBoard" class="btn">Export JSON</button>
          <button id="btnImportBoard" class="btn">Import JSON</button>
          <button id="btnReloadState" class="btn">Reload State</button>

          <input id="importFile" type="file" accept="application/json" hidden />
        </div>
      </section>
    </aside>

    <main id="dashboardView" class="workspace view-surface workspace-scroll">
      <header class="view-header">
        <h2 class="view-title">Project Dashboard</h2>
        <div id="dashboardPhase" class="dashboard-phase">Active Phase:
          Reading...</div>
      </header>

      <div class="split-grid">
        <!-- Vitals & Metrics -->
        <div class="stack-panel">
          <section class="panel">
            <h2>Milestone Burn-down</h2>
            <div id="dashboardBurndown">Loading...</div>
          </section>
          <section class="panel">
            <h2>Blockers</h2>
            <div id="dashboardBlockers" class="dashboard-blockers">None</div>
          </section>
          <section class="panel">
            <h2>Domain Metrics</h2>
            <div id="dashboardMetrics" class="dashboard-metrics">Loading project type...</div>
          </section>
        </div>

        <!-- Library & Traceability -->
        <div class="stack-panel">
          <section class="panel">
            <h2>Core Reference Library</h2>
            <div class="doc-button-row">
              <button class="btn btn-doc" data-doc="charter">Project Charter</button>
              <button class="btn btn-doc" data-doc="prd">PRD</button>
              <button class="btn btn-doc" data-doc="guardrails">Guardrails</button>
              <button class="btn btn-doc btn-doc-contract" data-doc="contract">Active
                Contract</button>
            </div>
          </section>
          <section class="panel">
            <h2>Traceability Feed (Git)</h2>
            <pre id="dashboardGitLog" class="traceability-log">Loading...</pre>
          </section>
        </div>
      </div>
    </main>

    <main id="chartsView" class="workspace charts-view view-surface view-no-scroll">
      <header class="charts-header">
        <div>
          <h2 class="view-title">Charts Library</h2>
          <div class="charts-subtitle">Select a chart to open it in the
            preview panel.</div>
        </div>
      </header>
      <section class="charts-layout">
        <section class="panel charts-list-panel">
          <h2>Available Charts</h2>
          <div id="chartsList" class="charts-list"></div>
          <div id="chartsListEmpty" class="empty-state charts-empty">No charts found yet. Generated charts
            will appear here.</div>
        </section>
        <aside id="chartsPanel" class="panel charts-preview-panel">
          <div class="charts-preview-header">
            <h2 id="chartsPanelTitle">Chart Preview</h2>
            <button id="btnCloseChartsPanel" class="btn">Dismiss</button>
          </div>
          <div id="chartsPanelContent" class="markdown-body charts-preview-content">
            Select a chart from the left to preview it.
          </div>
        </aside>
      </section>
    </main>

    <main id="guideView" class="workspace view-surface workspace-scroll">
      <header class="view-header view-header-split">
        <h2 class="view-title">MCD Methodology Playbook</h2>
        <button id="btnWhyMcd" class="btn btn-ghost-surface">Why
          MCD?</button>
      </header>
      <div id="guideContent" class="markdown-body guide-content">
        Loading playbook...
      </div>
    </main>

    <main id="boardView" class="workspace">
      <header class="workspace-header">
        <div class="title-wrap">
          <input id="boardName" class="board-name" maxlength="120" />
          <textarea id="boardDescription" class="board-description" rows="2" placeholder="Board description"></textarea>
        </div>
        <div class="header-actions">
          <button id="btnSaveBoard" class="btn">Save Board Meta</button>
          <button id="btnDeleteBoard" class="btn danger">Delete Board</button>
        </div>
      </header>

      <section class="toolbar">
        <div class="left-tools">
          <button id="btnAddCard" class="btn primary">+ Task</button>
          <button id="btnAddMilestone" class="btn">+ Milestone</button>
          <button id="btnAddList" class="btn">+ Column</button>
        </div>
        <div class="right-tools">
          <label>
            Milestone
            <select id="milestoneFilter"></select>
          </label>
          <label>
            Search
            <input id="searchInput" placeholder="Find task" />
          </label>
        </div>
      </section>

      <section id="kanbanColumns" class="kanban-columns"></section>
    </main>
  </div>

  <dialog id="docDialog" class="card-dialog doc-dialog">
    <form method="dialog" class="doc-dialog-form">
      <header class="modal-header">
        <h3 id="docDialogTitle" class="modal-title">Document</h3>
        <button value="close" class="btn">Close</button>
      </header>
      <div id="docDialogContent" class="markdown-body doc-dialog-content">
        Loading...</div>
    </form>
  </dialog>

  <!-- Why MCD Modal -->
  <dialog id="whyMcdDialog" class="card-dialog why-dialog">
    <form method="dialog">
      <div class="modal-header why-header">
        <h2 class="why-title">Why MCD?</h2>
        <button value="close" class="btn">Close</button>
      </div>
    </form>
    <div class="why-dialog-body">
      <p class="why-paragraph">The <strong>Micro-Contract Development (MCD)</strong> methodology was forged for
        solo operators collaborating with advanced AI agents. It trades raw conversational speed for systemic
        determinism.</p>

      <h3 class="why-section-title">Constraint is Freedom</h3>
      <p class="why-paragraph">By severely limiting what an AI agent can do without explicit permission, the
        operator guarantees that the architecture remains entirely under their control. No phantom files are generated,
        and no scope creep occurs without a formalized contract.</p>

      <h3 class="why-section-title">Total Observability</h3>
      <p class="why-paragraph">Every decision, rollback, and feature deployment is captured as a semantic,
        human-readable artifact. The operator never has to wonder <em>what</em> an AI agent changed while working on a
        complex feature.</p>

      <h3 class="why-section-title">Deterministic Engineering</h3>
      <p>Contracts act as both absolute instruction sets for the machine and historical ledgers for human operators,
        eliminating "black box" code drift and making the software's evolution totally replayable.</p>
    </div>
  </dialog>

  <dialog id="cardDialog" class="card-dialog">
    <form id="cardForm" method="dialog">
      <div class="card-dialog-header">
        <h3 id="cardDialogTitle">Task</h3>
        <span id="cardDialogIssueNumber" class="dialog-issue-badge is-hidden">—</span>
      </div>
      <input id="cardId" type="hidden" />

      <label>Title
        <input id="cardTitle" required maxlength="160" />
      </label>

      <div class="grid-two">
        <label>Milestone
          <select id="cardMilestone"></select>
        </label>
        <label>Priority
          <select id="cardPriority">
            <option value="P0">P0</option>
            <option value="P1">P1</option>
            <option value="P2">P2</option>
            <option value="P3">P3</option>
          </select>
        </label>
      </div>

      <div class="grid-two">
        <label>Status Column
          <select id="cardList"></select>
        </label>
        <label>Target Date
          <input id="cardTargetDate" type="date" />
        </label>
      </div>

      <label>Owner
        <input id="cardOwner" maxlength="80" placeholder="Optional" />
      </label>

      <label>Description
        <textarea id="cardDescription" rows="4" placeholder="What needs to happen?"></textarea>
      </label>

      <label>Acceptance
        <textarea id="cardAcceptance" rows="3" placeholder="How do we know this is done?"></textarea>
      </label>

      <menu>
        <button value="cancel" type="button" id="btnCancelCard" class="btn">Cancel</button>
        <button value="delete" type="button" id="btnDeleteCard" class="btn danger">Delete</button>
        <button value="save" type="submit" class="btn primary">Save</button>
      </menu>
    </form>
  </dialog>

  <template id="cardTemplate">
    <article class="card" draggable="true">
      <header>
        <span class="milestone-badge"></span>
        <span class="priority-badge"></span>
      </header>
      <h4></h4>
      <p class="description"></p>
      <footer>
        <span class="issue-badge"></span>
        <div class="spacer"></div>
        <span class="owner"></span>
        <span class="target-date"></span>
      </footer>
    </article>
  </template>

  <script src="/vendor/marked.min.js"></script>
  <script src="/vendor/mermaid.min.js"></script>
  <script src="/app.js" defer></script>
</body>

</html>
